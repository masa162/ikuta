---
import BaseLayout from "../layouts/BaseLayout.astro";
import HorizontalCard from "../components/HorizontalCard.astro";
import { getCollection } from "astro:content";
import Hero from "../components/Hero.astro";

// âœ… è¨˜äº‹å–å¾—ï¼†æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
const posts = (await getCollection("articles")).sort(
  (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
);
const last_posts = posts.slice(0, 3); // æ–°ç€3ä»¶

// âœ… å„è¨˜äº‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã®001.jpgã‚’å–å¾—
const thumbs = import.meta.glob(
  "../content/articles/*/001.{jpg,jpeg,png}",
  { eager: true, import: "default" }
);
const thumbBySlug = Object.fromEntries(
  Object.entries(thumbs).map(([path, mod]) => [
    path.split("/").at(-2), // slug
    mod
  ])
);
---

<BaseLayout
  title="clchair | ãã‚‰ã—ã¨å¥åº·ã®ç›¸è«‡å®¤"
  description="ã‚¯ãƒªãƒ¼ãƒ³ãƒã‚§ã‚¢ã¯ã€è–¬ãƒ»æ¼¢æ–¹ãƒ»é‹å‹•ãƒ»é£Ÿäº‹ãªã©ã‚’é€šã˜ã¦åœ°åŸŸã®å¥åº·ã‚’å¿œæ´ã—ã¦ã„ã¾ã™ã€‚"
  image="/ogp.png"
  url="https://clchair.netlify.app/"
  sideBarActiveItemID="home"
>
  <Hero />

  <section class="pb-12 mt-5 text-center md:text-left">
    <h1 class="text-3xl font-bold mb-2">ä»Šæ—¥ã‚‚å¥ã‚„ã‹ã«</h1>
    <p class="text-lg mb-2">
      æ¼¢æ–¹ã€æœè–¬ç›¸è«‡ã€ç”Ÿæ´»æ”¹å–„ï¼ˆé£Ÿäº‹ãƒ»é‹å‹•ï¼‰ã®æ”¯æ´ã‚’é€šã˜ã¦ã€æ—¥ã€…ã®ãã‚‰ã—ã‚’æ•´ãˆã‚‹ãŠæ‰‹ä¼ã„ã‚’ã—ã¦ã„ã¾ã™ã€‚
    </p>
    <p class="text-lg">
      ã‚ãªãŸè‡ªèº«ã®ãƒªã‚ºãƒ ã¨ç’°å¢ƒã«åˆã£ãŸæ”¯æ´ãŒå±Šãã‚ˆã†ã«ã€‚
    </p>
  </section>

  <section class="pb-12">
    <h2 class="text-2xl font-bold mb-4">ğŸ“° æ–°ç€è¨˜äº‹</h2>

    {last_posts.length > 0 ? (
      <div class="flex flex-col gap-6">
        {last_posts.map((post) => {
          let img = post.data.image;
          if (typeof img === "string" && !img.startsWith("/") && !img.startsWith("http")) {
            img = thumbBySlug[post.slug] ?? img;
          }
          if (!img) img = thumbBySlug[post.slug];

          return (
            <HorizontalCard
              title={post.data.title}
              desc={post.data.description}
              url={`/articles/${post.slug}`}
              img={img}
              tags={post.data.tags}
              pubDate={post.data.pubDate}
              target="_self"
            />
          );
        })}
        <div class="mt-6 text-right">
          <a href="/articles" class="btn btn-outline btn-sm">ã‚‚ã£ã¨è¦‹ã‚‹ â†’</a>
        </div>
      </div>
    ) : (
      <p class="text-gray-500">è¨˜äº‹ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    )}
  </section>
</BaseLayout>
