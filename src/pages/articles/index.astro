---
import BaseLayout from "../../layouts/BaseLayout.astro";
import HorizontalCard from "../../components/HorizontalCard.astro";
import { getCollection } from "astro:content";

// è¨˜äº‹ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ã—ã€æŠ•ç¨¿æ—¥ã§æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
const articles = (await getCollection("articles")).sort(
  (a, b) => new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf()
);

// å„è¨˜äº‹ãƒ•ã‚©ãƒ«ãƒ€ã® 001.(jpg|jpeg|png) ã‚’è‡ªå‹•ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const thumbs = import.meta.glob(
  "../../content/articles/*/001.{jpg,jpeg,png}",
  { eager: true, import: "default" }
);

// slug â†’ image metadata ã®è¾æ›¸ã‚’ä½œæˆï¼ˆä¾‹: '20250617' => ç”»åƒï¼‰
const thumbBySlug = Object.fromEntries(
  Object.entries(thumbs).map(([path, mod]) => [
    path.split("/").at(-2), // ãƒ‘ã‚¹æœ«å°¾ã®ãƒ•ã‚©ãƒ«ãƒ€åï¼ˆ= slugï¼‰
    mod
  ])
);
---

<script type="module">
  const $ = (s) => document.querySelectorAll(s);
  document.getElementById("search")?.addEventListener("input", (e) => {
    const kw = e.target.value.toLowerCase();
    $(".article-card").forEach((c) =>
      c.style.display = c.innerText.toLowerCase().includes(kw) ? "block" : "none"
    );
  });
</script>

<BaseLayout
  title="clchair | è¨˜äº‹ä¸€è¦§"
  description="æ¼¢æ–¹ãƒ»æœè–¬ç›¸è«‡ãƒ»é£Ÿäº‹ãƒ»é‹å‹•ãªã©ã€ãã‚‰ã—ã«ã¾ã¤ã‚ã‚‹è¨˜äº‹ã®ä¸€è¦§ã§ã™ã€‚"
  image="/ogp.png"
  url="https://clchair.netlify.app/articles"
  sideBarActiveItemID="articles"
>
  <section class="max-w-4xl mx-auto px-6 py-12">
    <h1 class="text-4xl font-bold mb-6">ğŸ—‚ è¨˜äº‹ä¸€è¦§</h1>

    <div class="mb-8">
      <input
        id="search"
        type="text"
        placeholder="ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ï¼ˆä¾‹ï¼šé‹å‹•ã€é£Ÿäº‹ï¼‰"
        class="input input-bordered w-full"
      />
    </div>

    {articles.length === 0 ? (
      <p class="text-gray-500 dark:text-gray-400">è¨˜äº‹ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    ) : (
      <div class="space-y-6">
        {articles.map(({ slug, data }) => {
          let img = data.image;

          // Frontmatterã®ç”»åƒãŒç›¸å¯¾ãƒ‘ã‚¹ï¼ˆ./img.jpgãªã©ï¼‰ãªã‚‰ã‚µãƒ ãƒã‚¤ãƒ«ã¨ç½®æ›
          if (typeof img === "string" && !img.startsWith("/") && !img.startsWith("http")) {
            img = thumbBySlug[slug] ?? img;
          }

          // Frontmatterã«ãªã‘ã‚Œã°ã€slugã‹ã‚‰è‡ªå‹•å–å¾—ï¼ˆ001.jpgï¼‰
          if (!img) img = thumbBySlug[slug];

          return (
            <div class="article-card">
              <HorizontalCard
                title={data.title}
                desc={data.description}
                img={img}
                url={`/articles/${slug}`}
                badge="ã‚¯ãƒªãƒ¼ãƒ³ãƒã‚§ã‚¢"
                tags={data.tags}
                pubDate={data.pubDate}
              />
            </div>
          );
        })}
      </div>
    )}
  </section>
</BaseLayout>
